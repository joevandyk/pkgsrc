# $NetBSD: Makefile,v 1.8 2007/03/17 08:45:03 obache Exp $
#

DISTNAME=	spl-1.0pre3
CATEGORIES=	lang
MASTER_SITES=	http://www.clifford.at/spl/releases/ \
		http://www.clifford.at/spl/releases/OLD/

MAINTAINER=	raphael@raphael.g-system.at
HOMEPAGE=	http://www.clifford.at/spl/
COMMENT=	The SPL Programming Language

USE_LANGUAGES=	c c++
USE_TOOLS+=	bash gmake gawk

SUBST_CLASSES+=		prefix
SUBST_STAGE.prefix=	pre-patch
SUBST_FILES.prefix=	GNUmakefile
SUBST_SED.prefix+=	-e 's,^  prefix.*,  prefix = ${PREFIX},g'
SUBST_SED.prefix+=	-e 's,^ENABLE_OPENGL_SUPPORT.*,ENABLE_OPENGL_SUPPORT=0,g'
SUBST_SED.prefix+=	-e 's,^  cgibin_libdir.*,  cgibin_libdir = ${PREFIX}/libexec/cgi-bin,g'

#subst.mk does not correctly detect GNUmakefile as text file
_SUBST_IS_TEXT_FILE=true

MAKE_ENV+=	ENABLE_OPENGL_SUPPORT=0
MAKE_FILE=	GNUmakefile
BUILD_TARGET=	all spldoc
EGDIR=		${PREFIX}/share/examples/spl
DOCDIR=		${PREFIX}/share/doc/spl

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/libexec/cgi-bin/webspl_cache
	${CHMOD} a+rwx ${PREFIX}/libexec/cgi-bin/webspl_cache
	${LN} -s ${PREFIX}/lib/spl_modules ${PREFIX}/libexec/cgi-bin/spl_modules
	${INSTALL_DATA_DIR} ${DOCDIR}
	cd ${WRKSRC} && ${PAX} -rw -p am README* manual.tex spldoc webspl_demo webspltut qtdemo ${DOCDIR}
	${INSTALL_DATA_DIR} ${EGDIR}
	cd ${WRKSRC}/examples && ${INSTALL_DATA} example* ${EGDIR}

.include "../../devel/ncurses/buildlink3.mk"
.include "../../devel/pcre/buildlink3.mk"
.include "../../devel/readline/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
